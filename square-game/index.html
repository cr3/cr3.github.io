<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8"><title>Square&#178; Game</title><style>body,canvas,html{width:100%;height:100%}footer,header,nav{font-size:12px;margin:2px}h1,h2{margin:0}body,html{margin:0;padding:0;font-family:Arial}canvas{top:0;left:0;position:absolute;image-rendering:crisp-edges;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast}.wrapper{width:320px;height:380px;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-user-select:none;user-select:none}section{width:300px;height:300px;margin:0 10px;position:relative}header,nav{display:flex;font-weight:700}header{height:46px}nav{height:26px}h1{font-size:20px}h2{font-size:10px}h3{font-size:20px;margin:20px 0 0}input[type=button]{background:#fff;border:4px solid #000;border-radius:3px;color:#000;text-decoration:none}input[type=button]:hover{background:#000;color:#fff;text-decoration:none}header input[type=button]{border:0;margin:4px;float:right}nav input[type=button]{flex:1 100%;margin:0 2px}input[type=text]{border:0;border-radius:3px;margin:4px;text-align:center;width:12px}.alternate{color:#bbada0}.info,.intro{flex:1 100%}.controls{background:#bbada0;border-radius:3px;color:#fff;height:25px}.counters{height:15px;margin:3px}.counter{float:right}.level{float:left}</style></head><body><div class="wrapper"><header><div class="intro"><h1>Square<span class="alternate">&#178;</span></h1><h2>Add grey squares over<br>the black squares.</h2></div><div class="info"><div class="controls"><input type="button" id="reset" value="New game"></div><div class="counters"><div class="level">Level <span class="alternate" id="level">1</span></div><div class="counter">Counter <span class="alternate" id="counter">0</span></div></div></div></header><section><canvas id="board" style="z-index: 0"><h2>Your browser doesn't support HTML5 Canvas.</h2></canvas><canvas id="player" style="z-index: 1"></canvas><canvas id="message" style="z-index: 2"></canvas></section><nav><input type="button" id="edit" value="+/-"><input type="button" id="left" value="&#8592;"><input type="button" id="right" value="&#8594;"><input type="button" id="up" value="&#8630;"><input type="button" id="down" value="&#8631;"></nav><footer><h3>How to play</h3><ol><li>Add or remove grey squares with the <strong>+/-</strong> button, or the <strong>Enter</strong> key.</li><li>Move all grey squares sideways with the <strong>&#8592;</strong> and <strong>&#8594;</strong> buttons, or the <strong>left</strong> and <strong>right</strong> arrow keys.</li><li>Rotate all grey squares with the <strong>&#8630;</strong> and <strong>&#8631;</strong> buttons, or the <strong>up</strong> and <strong>down</strong> arrow keys.</li><li>Add more grey squares, move and rotate until all black squares are covered.</li></ol></footer></div><script>!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();</script><script>function extend(a){var b,c;for("undefined"==typeof a&&(a={}),b=1;b<arguments.length;++b)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&"undefined"==typeof a[c]&&(a[c]=arguments[b][c]);return a}</script><script>var Matrix=function(a){var b=[],c=function(){b=b[0].map(function(a,c){return b.map(function(a){return a[c]})})};return{cols:function(){return b.length},rows:function(){return b[0].length},get:function(a,c){return b[a][c]},set:function(a,c,d){b[a][c]=d},reset:function(c,d){var e,f,g;for(b=[],e=0;c>e;++e){for(g=[],f=0;d>f;++f)g[f]=a;b[e]=g}},compare:function(b){var c,d,e=this.cols(),f=this.rows();if(!b||b.cols()!==e||b.rows()!==f)return!1;for(c=0;e>c;++c)for(d=0;f>d;++d)if(this.get(c,d)===a&&b.get(c,d)!==a||this.get(c,d)!==a&&b.get(c,d)===a)return!1;return!0},iterate:function(a){var b,c,d=this.cols(),e=this.rows();for(b=0;d>b;++b)for(c=0;e>c;++c)a(this,b,c)},move:function(a){switch(a){case"left":b.push(b.shift());break;case"right":b.unshift(b.pop());break;case"anticlockwise":b.reverse(),c();break;case"clockwise":c(),b.reverse();break;default:throw{name:"TypeError",message:"Unknown direction: "+a}}}}};</script><script>var Action=function(a,b){var c={inversed:!1},d={add:"remove",remove:"add",left:"right",right:"left",up:"down",down:"up"};return b=extend(b,c),{name:a,options:b,inverse:function(){var c=d[a],e=Object.create(b);return e.inversed=!b.inversed,Action(c,e)}}};</script><script>var Counter=function(a){var b=parseInt(a.innerHTML,10),c=b;return{count:function(){return c},decrement:function(){c>b&&(--c,this.draw())},increment:function(){++c,this.draw()},draw:function(){a.innerHTML=c},reset:function(){c=b,this.draw()}}};</script><script>var Level=function(a){var b=Counter(a);return b.cols=function(){return Math.max(Math.ceil(Math.sqrt(this.count()+1)),3)},b.rows=function(){return Math.max(Math.ceil(Math.sqrt(this.count()+1)),3)},b.size=function(){return this.cols()*this.rows()},b};</script><script>var Message=function(a){var b,c=a.getContext("2d");return{draw:function(){var a=Math.floor(c.canvas.width/10);b?(c.globalAlpha=.5,c.fillStyle="#bbada0",c.fillRect(0,0,c.canvas.width,c.canvas.height),c.globalAlpha=1,c.font=a+"px Arial",c.fillStyle="black",c.textAlign="center",c.fillText(b,c.canvas.width/2,c.canvas.height/2)):c.clearRect(0,0,c.canvas.width,c.canvas.height)},reset:function(a){b=a,this.draw()},resize:function(a){c.canvas.width=a,c.canvas.height=a,this.draw()}}};</script><script>var Pointer=function(a){var b,c,d,e={allowedTime:300,restraint:50,threshold:50};return a=extend(a,e),{start:function(a,e){b=(new Date).getTime(),c=a,d=e},end:function(e,f){var g="noop",h=e-c,i=f-d,j=(new Date).getTime()-b;return j<a.allowedTime&&(Math.abs(h)>=a.threshold&&Math.abs(i)<a.restraint?g=0>h?"left":"right":Math.abs(i)>=a.threshold&&Math.abs(h)<a.restraint&&(g=0>i?"up":"down")),g}}};</script><script>var Square=function(a){var b={fillStyle:"black",globalAlpha:1,lineWidth:0,margin:0,strokeStyle:"white"};return a=extend(a,b),{draw:function(b,c,d,e){var f=e-2*a.margin;b.beginPath(),b.globalAlpha=a.globalAlpha,b.fillStyle=a.fillStyle,b.rect(c*e+a.margin,d*e+a.margin,f,f),b.fill(),b.lineWidth=a.lineWidth,b.strokeStyle=a.strokeStyle,b.stroke()}}};</script><script>var Input=function(a){var b=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend"],c=["keydown","keyup","resize","orientationchange"],d={8:"undo",27:"undo",13:"edit",32:"edit",37:"left",39:"right",38:"up",40:"down",72:"left",76:"right",75:"up",74:"down",65:"left",68:"right",87:"up",83:"down"},e={},f=Pointer(),g=function(a,b){var c=e[a];c&&c.forEach(function(a){a(b)})},h=function(){var d,e,f;for(e=a.getElementsByTagName("input"),f=0;f<e.length;++f)"button"===e[f].type&&e[f].addEventListener("click",i,!1);e=a.getElementsByTagName("canvas"),d=e[e.length-1],b.forEach(function(a){d.addEventListener(a,i,!1)}),c.forEach(function(a){window.addEventListener(a,i,!1)})},i=function(a){var b,c="noop",e=a.altKey||a.ctrlKey||a.metaKey||a.shiftKey;switch(a=a||window.event,a.type){case"resize":case"orientationchange":c="resize";break;case"keydown":!e&&d[a.keyCode]&&a.preventDefault();break;case"keyup":e||(c=d[a.keyCode]);break;case"click":c=a.target.id;break;case"MSPointerDown":case"mousedown":case"touchstart":b=a.changedTouches?a.changedTouches[0]:a,f.start(b.pageX,b.pageY),a.preventDefault();break;case"MSPointerMove":case"mousemove":case"touchmove":a.preventDefault();break;case"MSPointerUp":case"mouseup":case"touchend":b=a.changedTouches?a.changedTouches[0]:a,c=f.end(b.pageX,b.pageY),"noop"===c&&(c="edit"),a.preventDefault();break;default:throw{name:"TypeError",message:"Unknown event type: "+a.type}}j(c)},j=function(a){switch(a){case"left":case"right":case"up":case"down":g("move",a);break;case"noop":break;default:g(a)}};return h(),{on:function(a,b){e[a]||(e[a]=[]),e[a].push(b)},reset:function(){e={}}}};</script><script>var Board=function(a,b){var c=Square({margin:4}),d=a.getContext("2d");b||(b=Matrix(null));var e=function(a){var b,c=[];for(b=0;a>b;++b)c.push(b);return c},f=function(a){for(var b,c,d=a.slice(0),e=a.length;e--;)c=Math.floor((e+1)*Math.random()),b=d[c],d[c]=d[e],d[e]=b;return d},g=function(a,b){return f(a).slice(0,b)};return{matrix:b,cols:function(){return b.cols()},rows:function(){return b.rows()},draw:function(){var a=Math.min(d.canvas.width,d.canvas.height),c=Math.floor(a/Math.max(b.cols(),b.rows()));d.clearRect(0,0,d.canvas.width,d.canvas.height),b.iterate(function(a,b,e){var f=a.get(b,e);f&&f.draw(d,b,e,c)})},reset:function(a,d,f){for(var h,i=a*d;;)if(h=g(e(i),f),1!=f||4!=h[0])break;b.reset(a,d),h.forEach(function(e){var f=Math.floor(e/a),g=e%d;b.set(f,g,c)}),this.draw()},resize:function(a){d.canvas.width=a,d.canvas.height=a,this.draw()}}};</script><script>var Player=function(a,b){var c={steps:5},d=Square({fillStyle:"#bbada0",margin:25}),e=a.getContext("2d"),f=Matrix(null),g=Board(a,f),h=[],i=[],j=0,k=function(){var a=h[0];switch(a.name){case"undo":l(a);break;case"add":case"remove":m(a);break;case"left":case"right":case"up":case"down":n(a);break;default:throw{name:"TypeError",message:"Unknown action: "+a.name}}g.draw(),j>=b.steps&&(a.options.inversed||i.push(a),h.shift(),a.options.callback(),j=0),h.length&&window.requestAnimationFrame(k)},l=function(a){h.shift(),i.length&&h.push(i.pop().inverse())},m=function(a){var c=a.options.col,e=a.options.row,g=f.get(c,e),i="add"==a.name?d:null;i!==g?(f.set(c,e,i),j+=b.steps):h.shift()},n=function(a){var c=a.name;if(i.length){switch(j||e.save(),a.name){case"left":o(-1);break;case"right":o(1);break;case"up":c="anticlockwise",p(-1);break;case"down":c="clockwise",p(1)}++j>=b.steps&&(e.restore(),f.move(c))}else h.shift()},o=function(a){var c,d,g=a>0?f.cols()-1:0,h=a>0?-1:f.cols(),i=e.canvas.width/f.cols(),j=a*i/b.steps,k=0;for(e.clearRect(h*i,0,i,e.canvas.height),c=0;c<f.rows();++c)d=f.get(g,c),d&&d.draw(e,h,c,i);e.translate(j,k)},p=function(a){var c=Math.max(f.cols(),f.rows()),d=a*Math.PI/2/b.steps,g=e.canvas.width*f.cols()/c,h=e.canvas.height*f.rows()/c,i=((1-Math.cos(d))*g+Math.sin(d)*h)/2,j=-(Math.sin(d)*g+Math.cos(d)*h-h)/2;e.translate(i,j),e.rotate(d)};return b=extend(b,c),g.reset=function(a,b){h=[],i=[],j=0,f.reset(a,b),g.draw()},g.edit=function(a,b,c,d){h.push(Action(a,{callback:d,col:b,row:c})),window.requestAnimationFrame(k)},g.move=function(a,b){h.push(Action(a,{callback:b})),window.requestAnimationFrame(k)},g.undo=function(a){h.push(Action(a)),window.requestAnimationFrame(k)},g};</script><script>var Manager=function(a){var b=Input(a),c=Board(document.getElementById("board")),d=Counter(document.getElementById("counter")),e=Level(document.getElementById("level")),f=Message(document.getElementById("message")),g=Player(document.getElementById("player")),h=function(){c.matrix.compare(g.matrix)&&(f.reset("Level complete"),b.reset(),b.on("edit",i),b.on("move",i),b.on("reset",i),b.on("resize",m))},i=function(){e.increment(),l()},j=function(){var a=Math.floor((g.matrix.cols()-1)/2),b=Math.floor((g.matrix.rows()-1)/2),c=g.matrix.get(a,b)?"remove":"add";g.edit(c,a,b,h),d.increment()},k=function(a){d.count()&&(g.move(a,h),d.increment())},l=function(){c.reset(e.cols(),e.rows(),e.count()),g.reset(e.cols(),e.rows()),d.reset(),f.reset(),b.reset(),b.on("edit",j),b.on("move",k),b.on("reset",l),b.on("resize",m)},m=function(){var b=[a.offsetWidth,a.offsetHeight];a.style.overflow="scroll";var d=[b[0]-a.clientWidth,b[1]-a.clientHeight];a.style.overflow=null;var e=[window.innerWidth-d[0],window.innerHeight],h=Math.floor(10*Math.min(e[0]/b[0],e[1]/b[1]))/10,i=b[0]*h,j=(e[0]-i)/2,k="translate("+j+"px, 0px) scale("+h+")";c.resize(i),g.resize(i),f.resize(i),a.style.transform=k,a.style.webkitTransform=k};return{run:function(){l(),m()}}};</script><script>window.requestAnimationFrame(function(){var a=Manager(document.body.children[0]);a.run()});</script></body></html>